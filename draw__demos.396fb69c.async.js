(self.webpackChunkFun4fun=self.webpackChunkFun4fun||[]).push([[931],{92271:function(v,E,y){"use strict";y.r(E),y.d(E,{default:function(){return Gt}});var L=y(67294),C=y(56690),f=y.n(C),b=y(89728),m=y.n(b),A=y(66115),k=y.n(A),x=y(41588),R=y.n(x),z=y(73808),W=y.n(z),F=y(61655),H=y.n(F),et=y(26389),U=y.n(et),it=y(38416),l=y.n(it),rt=y(861),J=y.n(rt),st=y(27424),g=y.n(st),nt=y(74704),at=y.n(nt),ot=y(70215),ht=y.n(ot),ut=y(18698),lt=y.n(ut),vt=y(42122),V=y.n(vt),dt=function h(n,t){var i=V()({},t);return Object.keys(t).forEach(function(e){n[e]&&lt()(n[e])==="object"&&n[e]!=null?i[e]=h(n[e],t[e]):n[e]!=null?i[e]=n[e]:i[e]=t[e]}),i},D=function(n,t){return t?dt(t,n):n},yt=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=Math.random()*16|0,i=n==="x"?t:t&3|8;return i.toString(16)})},Xt=function(n,t,i){var e=i.getBoundingClientRect();return{x:n-e.left-(e.width-i.width)/2,y:t-e.top-(e.height-i.height)/2}},$t=function(){for(var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",t=0,i=0;i<n.length;)n[i].charCodeAt(0)>=19968?t+=n[i].length:t+=1,i++;return t};function Vt(h,n,t,i,e,r){var s=r.borderColor,a=r.borderRadius,o=r.dashed,u=r.backgroundColor,d=r.borderWidth;if(2*a>i||2*a>e)return!1;h.save(),h.translate(n,t),ct(h,i,e,a),h.fillStyle=u,o?h.setLineDash([5]):h.setLineDash([0]),h.lineWidth=d,h.strokeStyle=s,h.fill(),h.stroke(),h.restore()}function ct(h,n,t,i){h.beginPath(),h.arc(n-i,t-i,i,0,Math.PI/2),h.lineTo(i,t),h.arc(i,t-i,i,Math.PI/2,Math.PI),h.lineTo(0,i),h.arc(i,i,i,Math.PI,Math.PI*3/2),h.lineTo(n-i,0),h.arc(n-i,i,i,Math.PI*3/2,Math.PI*2),h.lineTo(n,t-i),h.closePath()}function ft(h,n,t){var i=n<0?h.length+n:n;if(i>=0&&i<h.length){var e=t<0?h.length+t:t,r=h.splice(n,1),s=g()(r,1),a=s[0];h.splice(e,0,a)}}function $(h,n,t){var i=J()(h);return ft(i,n,t),i}function K(h){var n=Object.prototype.toString.call(h).slice(8,-1).toLowerCase();return console.log(n),["object","function","null","array"].includes(n)}function Q(h){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new WeakMap;if(!K(h))return h;if(n.has(h))return n.get(h);var t=Array.isArray(h)?[]:{};n.set(h,t);for(var i in h)K(h[i])?t[i]=Q(h[i],n):t[i]=h[i];return t}var Z=function(){function h(){f()(this,h),l()(this,"funcList",[])}return m()(h,[{key:"on",value:function(t,i){var e=this.funcList.findIndex(function(r){return r.name===t});e>-1&&this.funcList.splice(e,1),this.funcList.push({name:t,fc:i})}},{key:"emit",value:function(t,i){var e=this.funcList.find(function(r){return r.name===t});e&&e.fc.call(this,i)}},{key:"off",value:function(t){this.funcList=this.funcList.filter(function(i){return i.name!==t})}}]),h}(),pt=function(){function h(n,t){f()(this,h),l()(this,"x",void 0),l()(this,"y",void 0),this.x=Number(n.toFixed(2)),this.y=Number(t.toFixed(2))}return m()(h,[{key:"toArray",value:function(){return[this.x,this.y]}},{key:"update",value:function(t,i){this.x=Number(t.toFixed(2)),this.y=Number(i.toFixed(2))}},{key:"getTruePosition",value:function(t){return[this.x/t,this.y/t]}}],[{key:"rotateByPoint",value:function(t,i,e){var r=(t.x-i.x)*Math.cos(e)-(t.y-i.y)*Math.sin(e)+i.x,s=(t.x-i.x)*Math.sin(e)+(t.y-i.y)*Math.cos(e)+i.y;return new h(r,s)}},{key:"rotate",value:function(t,i){return h.rotateByPoint(t,new h(0,0),i)}},{key:"getCenter",value:function(t,i){return new h((t.x+i.x)/2,(t.y+i.y)/2)}},{key:"fromArray",value:function(t){var i=g()(t,2),e=i[0],r=i[1];return new h(e,r)}},{key:"clone",value:function(t){return new h(t.x,t.y)}}]),h}(),p=pt,gt=["canvas","context"],mt=function(){function h(n){if(f()(this,h),l()(this,"layers",[]),l()(this,"selectedLayers",[]),l()(this,"activedLayer",void 0),l()(this,"layout",void 0),l()(this,"animationFrame",void 0),l()(this,"isDrag",!1),l()(this,"canvas",void 0),l()(this,"context",void 0),l()(this,"eventCenter",new Z),!n)throw new Error("need a div target");var t=this.creatElement(n),i=t.canvas,e=t.context,r=ht()(t,gt);this.canvas=i,this.context=e,this.layout=r,this.bindEvents(),this.render()}return m()(h,[{key:"scale",get:function(){var t=this.layout.zoom;return t>0?t+1:t<0?1/(-t+1):1}},{key:"creatElement",value:function(t){var i=document.createElement("canvas"),e=window.devicePixelRatio||1,r=window.getComputedStyle(t),s=parseFloat(r.width),a=parseFloat(r.height);i.width=s*e,i.height=a*e,i.style.width=s+"px",i.style.height=a+"px",i.style.cursor="grab",i.style.userSelect="none";var o=i.getContext("2d");return o.scale(e,e),o.translate(s/2,a/2),t.appendChild(i),{dpr:e,zoom:0,width:s,height:a,origin:new p(0,0),offset:new p(0,0),canvas:i,context:o}}},{key:"addlayer",value:function(t){return Array.isArray(t)?this.layers=this.layers.concat(t):this.layers.push(t),this.layers}},{key:"deleteLayer",value:function(t){for(var i=this,e=0;e<this.layers.length;e++)if(Array.isArray(t)){var r=at()(t),s;try{var a=function(){var d=s.value;if(d===i.layers[e]){i.layers.splice(e,1);var c=i.selectedLayers.findIndex(function(P){return P==d});c>-1&&i.selectedLayers.splice(c,1)}};for(r.s();!(s=r.n()).done;)a()}catch(u){r.e(u)}finally{r.f()}}else if(t===this.layers[e]){this.layers.splice(e,1);var o=this.selectedLayers.findIndex(function(u){return u==t});o>-1&&this.selectedLayers.splice(o,1)}return this.layers}},{key:"selectLayerByUuid",value:function(t){for(var i=0;i<this.layers.length;i+=1)if(this.layers[i].uuid==t)return this.layers[i]}},{key:"layerMove",value:function(t,i){this.layers=$(this.layers,t,i),this.eventCenter.emit("layerChange",this.layers)}},{key:"notifyAllObservers",value:function(t){for(var i=arguments.length,e=new Array(i>1?i-1:0),r=1;r<i;r++)e[r-1]=arguments[r];this.layers.forEach(function(s){var a;return(a=s.update).call.apply(a,[s,t].concat(e))})}},{key:"paint",value:function(){var t,i=this.layout,e=i.width,r=i.height,s=i.offset,a=this.context;if(a){a.clearRect(-e/2,-r/2,e*2,r*2),a.save();var o=s.getTruePosition(this.scale),u=g()(o,2),d=u[0],c=u[1];a.translate(d,c);for(var P=0;P<this.layers.length;P+=1)this.layers[P].render(a,this.scale);(t=this.activedLayer)===null||t===void 0||t.render(a,this.scale),a.restore()}}},{key:"resize",value:function(){var t=this.canvas.parentElement,i=window.getComputedStyle(t),e=parseFloat(i.width),r=parseFloat(i.height);this.canvas.width=e*this.layout.dpr,this.canvas.height=r*this.layout.dpr,this.canvas.style.width=e+"px",this.canvas.style.height=r+"px",this.layout.width=e,this.layout.height=r,this.context.scale(this.layout.dpr,this.layout.dpr),this.context.translate(this.layout.width/2,this.layout.height/2)}},{key:"render",value:function(){this.animationFrame=requestAnimationFrame(this.render.bind(this)),this.paint()}},{key:"destroy",value:function(){this.animationFrame&&cancelAnimationFrame(this.animationFrame)}},{key:"getLayerByPosition",value:function(t){for(var i=J()(this.layers);i.length;){var e=i.pop();if(!e)return;if(e.isInPath(t))return e}}},{key:"getPosition",value:function(t){var i=t.offsetX,e=t.offsetY,r=this.layout,s=r.origin,a=r.width,o=r.height,u=i-a/2,d=e-o/2,c=u*this.scale,P=d*this.scale;return new p(c-s.x,P-s.y)}},{key:"onWheel",value:function(t){t.preventDefault(),t.deltaY<0?this.layout.zoom=Math.min(3,this.layout.zoom+1):this.layout.zoom=Math.max(-3,this.layout.zoom-1)}},{key:"bindEditEvent",value:function(t){var i=this,e=this.canvas;e.onmouseup=function(r){r.preventDefault(),t.update("onmouseup",i.getPosition(r)),e.onmousemove=function(s){return i.onHover.call(i,s)},e.onmouseup=null},e.onmouseleave=function(r){r.preventDefault(),t.update("onmouseup",i.getPosition(r)),e.onmousemove=function(s){return i.onHover.call(i,s)},e.onmouseup=null,e.onmouseleave=null},e.onmousemove=function(r){r.preventDefault(),t.update("onmousemove",i.getPosition(r))}}},{key:"bindDragEvent",value:function(t,i){var e=this,r=this.canvas,s=this.layout.origin;this.isDrag=!1,r.onmousemove=function(o){o.preventDefault(),e.isDrag=!0,r.style.cursor="grabbing";var u=e.getPosition(o),d=u.x-t.x,c=u.y-t.y;if(e.selectedLayers.length>0)e.selectedLayers.forEach(function(S){var I=S.origin.toArray(),O=g()(I,2),j=O[0],N=O[1]});else{var P=s.toArray(),w=g()(P,2),T=w[0],M=w[1];e.layout.offset.update(T+d,M+c)}r.onmouseleave=function(S){S.preventDefault(),a.call(e,S),r.onmousemove=function(I){return e.onHover.call(e,I)},r.onmouseup=null,r.onmouseleave=null,e.isDrag=!1}};var a=function(u){var d=e.getPosition(u),c=d.x-t.x,P=d.y-t.y;if(e.selectedLayers.length>0)e.selectedLayers.forEach(function(I){var O=I.origin.toArray(),j=g()(O,2),N=j[0],G=j[1];I.origin.update(N+c,G+P)});else{var w=s.toArray(),T=g()(w,2),M=T[0],S=T[1];e.layout.origin.update(M+c,S+P)}r.style.cursor="grab"};r.onmouseup=function(o){o.preventDefault(),e.isDrag?a.call(e,o):i&&i.update("emit","onclick",o),r.onmousemove=function(u){return e.onHover.call(e,u)},r.onmouseup=null,r.onmouseleave=null,e.isDrag=!1}}},{key:"onMouseDown",value:function(t){t.preventDefault();var i=t.button;if(i===0){var e=this.getPosition(t),r=this.getLayerByPosition(e);r&&r.isEdit?(r.update("onmousedown",e),this.bindEditEvent(r)):this.bindDragEvent(e,r)}}},{key:"onMouseLeave",value:function(t){t.preventDefault(),this.isDrag=!1}},{key:"onHover",value:function(t){var i=this;t.preventDefault();var e=this.canvas,r=this.getPosition(t),s=this.getLayerByPosition(r);s?(!s.isMouseIn&&!s.isEdit&&(this.eventCenter.emit("mouseenter",s),s.isMouseIn=!0,s.update("onhover")),e.style.cursor="inherit"):e.style.cursor="grab",this.layers.forEach(function(a){a!=s&&a.isMouseIn&&(i.eventCenter.emit("mouseleave",s),a.isMouseIn=!1)})}},{key:"on",value:function(t,i){this.eventCenter.on(t,i)}},{key:"onContextMenu",value:function(t){t.preventDefault()}},{key:"bindEvents",value:function(){var t=this,i=this.canvas;i.onwheel=function(e){return t.onWheel.call(t,e)},i.onmousedown=function(e){return t.onMouseDown.call(t,e)},i.onmouseleave=function(e){return t.onMouseLeave.call(t,e)},i.oncontextmenu=function(e){return t.onContextMenu.call(t,e)},i.onmousemove=function(e){return t.onHover.call(t,e)}}},{key:"removeEvents",value:function(){var t=this.canvas;t.onmousedown=null,t.onmouseleave=null,t.oncontextmenu=null,t.onmousemove=null}},{key:"afterPaint",value:function(){var t;this.removeEvents(),this.canvas.style.cursor="grab",(t=this.activedLayer)===null||t===void 0||t.reset(),this.bindEvents()}},{key:"reset",value:function(){this.afterPaint(),this.layout.offset.update(0,0),this.layout.origin.update(0,0),this.layout.zoom=0}}]),h}(),kt=function(){function h(){f()(this,h),l()(this,"el",void 0),l()(this,"poisition",void 0),l()(this,"isOpen",!1),l()(this,"onDelete",void 0),l()(this,"onEdit",void 0);var n=document.createElement("div");this.el=n,n.className="draw-menu"}return m()(h,[{key:"open",value:function(t,i,e){var r=this;this.isOpen=!0,this.el.innerHTML="";var s={onSave:"\u4FDD\u5B58",onCancel:"\u53D6\u6D88",onEdit:"\u7F16\u8F91\u56FE\u5C42",onDelete:"\u5220\u9664\u56FE\u5C42"};Object.keys(e).forEach(function(a){var o=a,u=e[o];if(s[o]&&u){var d=document.createElement("div");d.innerHTML=s[o],d.className="item",d.onclick=function(){u.call(r),r.close()},r.el.appendChild(d)}}),this.el.style.display="block",this.el.style.left=t+"px",this.el.style.top=i+"px"}},{key:"close",value:function(){this.el.style.display="none",this.isOpen=!1}},{key:"remove",value:function(){var t;(t=this.el.parentNode)===null||t===void 0||t.removeChild(this.el),this.isOpen=!1}}]),h}(),X=function(){function h(n){f()(this,h),l()(this,"uuid",void 0),l()(this,"type",void 0),l()(this,"isEdit",!1),l()(this,"isMouseIn",!1),l()(this,"origin",new p(0,0)),l()(this,"evetCenter",new Z),this.uuid=yt(),this.type=n}return m()(h,[{key:"update",value:function(t){for(var i=Object.getPrototypeOf(this)[t],e=arguments.length,r=new Array(e>1?e-1:0),s=1;s<e;s++)r[s-1]=arguments[s];if(i)return i.apply(this,r)}},{key:"emit",value:function(t){for(var i,e=arguments.length,r=new Array(e>1?e-1:0),s=1;s<e;s++)r[s-1]=arguments[s];(i=this.evetCenter).emit.apply(i,[t].concat(r))}},{key:"onclick",value:function(t){var i=this;this.evetCenter.on("onclick",function(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];t.apply.apply(t,[i].concat(r))})}},{key:"onhover",value:function(t){var i=this;this.evetCenter.on("onhover",function(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];t.apply.apply(t,[i].concat(r))})}}]),h}(),Pt=function(){function h(n,t,i){f()(this,h),l()(this,"center",void 0),l()(this,"radius",void 0),l()(this,"ctrlRadius",4),l()(this,"style",void 0),l()(this,"active",void 0),l()(this,"sx",0),l()(this,"sy",0),l()(this,"px",0),l()(this,"py",0),this.center=p.clone(n),this.radius=t,this.style=i}return m()(h,[{key:"ctrPoint",get:function(){var t=this.center.x+this.radius;return new p(t,this.center.y)}},{key:"draw",value:function(t,i){t.beginPath(),t.lineWidth=this.style.borderWidth,this.style.dashed?t.setLineDash([5]):t.setLineDash([0]),t.strokeStyle=this.style.borderColor,t.fillStyle=this.style.backgroundColor;var e=this.center.getTruePosition(i),r=g()(e,2),s=r[0],a=r[1];t.arc(s,a,this.radius/i,0,2*Math.PI),t.stroke(),t.fill(),t.closePath(),this.drawCtr(this.ctrPoint,t,i),this.drawCtr(this.center,t,i)}},{key:"drawCtr",value:function(t,i,e){i.beginPath(),i.lineWidth=1,i.setLineDash([0]),i.strokeStyle="green",i.fillStyle="#1890ff";var r=t.getTruePosition(e),s=g()(r,2),a=s[0],o=s[1];i.arc(a,o,this.ctrlRadius,0,Math.PI*2),i.fill(),i.closePath(),i.stroke()}},{key:"isInCtrPoint",value:function(t,i,e){return t>e.x-this.ctrlRadius&&t<e.x+this.ctrlRadius&&i>e.y-this.ctrlRadius&&i<e.y+this.ctrlRadius}},{key:"isInPath",value:function(t){var i=t.x,e=t.y;if(this.isInCtrPoint(i,e,this.center))return this.active="start",!0;if(this.isInCtrPoint(i,e,this.ctrPoint))return this.active="end",!0;this.active=void 0;var r=Math.sqrt(Math.pow(e-this.center.y,2)+Math.pow(i-this.center.x,2));return r<this.radius}},{key:"onmousedown",value:function(t){this.sx=t.x,this.sy=t.y,this.active=="start"?(this.px=this.center.x,this.py=this.center.y):this.active=="end"&&(this.px=this.ctrPoint.x,this.py=this.ctrPoint.y)}},{key:"onmousemove",value:function(t){var i=t.x-this.sx,e=t.y-this.sy;this.active=="start"?this.center=new p(this.px+i,this.py+e):this.active=="end"&&(this.radius=Math.sqrt(Math.pow(this.py+e-this.center.y,2)+Math.pow(this.px+i-this.center.x,2)))}},{key:"onSave",value:function(){return{center:this.center,radius:this.radius,style:this.style}}},{key:"changeStyle",value:function(t){this.style=t}},{key:"changeRadius",value:function(t){this.radius=t}}]),h}(),bt={backgroundColor:"rgba(3,3,3,.2)",borderColor:"transparent",borderWidth:1,dashed:!1},wt=function(h){H()(t,h);var n=U()(t);function t(i){var e,r=i.center,s=i.radius,a=i.style;return f()(this,t),e=n.call(this,"circular"),l()(k()(e),"style",void 0),l()(k()(e),"styleBack",void 0),l()(k()(e),"center",void 0),l()(k()(e),"centerBack",void 0),l()(k()(e),"radius",void 0),l()(k()(e),"radiusBack",void 0),l()(k()(e),"editLayer",void 0),e.style=e.styleBack=D(bt,a),e.center=e.centerBack=p.clone(r),e.radius=e.radiusBack=Number(s.toFixed(2)),e}return m()(t,[{key:"render",value:function(e,r){if(this.isEdit){var s;(s=this.editLayer)===null||s===void 0||s.draw(e,r)}else{e.beginPath(),e.lineWidth=this.style.borderWidth,this.style.dashed?e.setLineDash([5]):e.setLineDash([0]),e.strokeStyle=this.style.borderColor,e.fillStyle=this.style.backgroundColor;var a=this.center.getTruePosition(r),o=g()(a,2),u=o[0],d=o[1];e.arc(u,d,this.radius/r,0,2*Math.PI),e.stroke(),e.fill(),e.closePath()}}},{key:"getArea",value:function(){return Math.PI*Math.pow(this.radius,2)}},{key:"isInPath",value:function(e){if(this.isEdit){var r,s;return(r=(s=this.editLayer)===null||s===void 0?void 0:s.isInPath(e))!==null&&r!==void 0?r:!1}else{var a=Math.sqrt(Math.pow(e.y-this.center.y,2)+Math.pow(e.x-this.center.x,2));return a<this.radius}}},{key:"startEdit",value:function(){this.isEdit=!0,this.editLayer=new Pt(this.center,this.radius,this.style)}},{key:"saveEdit",value:function(){if(this.editLayer){var e=this.editLayer.onSave(),r=e.center,s=e.radius,a=e.style;this.center=p.clone(r),this.centerBack=p.clone(r),this.style=this.styleBack=a,this.radius=s,this.radiusBack=s,this.editLayer=void 0,this.isEdit=!1}}},{key:"cancelEdit",value:function(){this.editLayer=void 0,this.isEdit=!1,this.reset()}},{key:"reset",value:function(){this.center=p.clone(this.centerBack),this.style=this.styleBack}},{key:"onmousedown",value:function(e){if(this.isEdit){var r;(r=this.editLayer)===null||r===void 0||r.onmousedown.call(this.editLayer,e)}}},{key:"onmousemove",value:function(e){if(this.isEdit){var r;(r=this.editLayer)===null||r===void 0||r.onmousemove.call(this.editLayer,e)}}}]),t}(X),Et={borderWidth:2,borderColor:"green",backgroundColor:"rgba(255,255,0, .5)",dashed:!0},Ct=function(){function h(n){f()(this,h),l()(this,"center",void 0),l()(this,"actived",void 0),l()(this,"style",void 0),this.style=D(Et,n)}return m()(h,[{key:"setActived",value:function(t){this.center&&(this.actived=p.clone(t))}},{key:"setCenter",value:function(t){this.center=t}},{key:"radius",get:function(){return!this.center||!this.actived?0:Math.sqrt(Math.pow(this.center.y-this.actived.y,2)+Math.pow(this.center.x-this.actived.x,2))}},{key:"reset",value:function(){this.center=void 0,this.actived=void 0}},{key:"drawCenter",value:function(t,i){if(this.center){t.save(),t.beginPath(),t.fillStyle=this.style.borderColor,t.lineWidth=0,t.setLineDash([0]);var e=this.center.getTruePosition(i),r=g()(e,2),s=r[0],a=r[1];t.arc(s,a,4,0,2*Math.PI),t.stroke(),t.fill(),t.closePath(),t.restore()}}},{key:"render",value:function(t,i){if(this.center&&this.radius){t.save(),t.beginPath(),t.lineWidth=this.style.borderWidth,this.style.dashed?t.setLineDash([5]):t.setLineDash([0]),t.strokeStyle=this.style.borderColor,t.fillStyle=this.style.backgroundColor;var e=this.center.getTruePosition(i),r=g()(e,2),s=r[0],a=r[1];t.arc(s,a,this.radius/i,0,2*Math.PI),t.stroke(),t.fill(),t.closePath(),this.drawCenter(t,i),t.restore()}}}]),h}(),Lt=function(){function h(n,t){f()(this,h),l()(this,"path",void 0),l()(this,"style",void 0),l()(this,"sx",0),l()(this,"sy",0),l()(this,"px",0),l()(this,"py",0),l()(this,"ctrlRadius",4),l()(this,"actived",-1),l()(this,"targets","path"),this.path=n.map(function(i){return p.clone(i)}),this.style=t}return m()(h,[{key:"paint",value:function(t,i){t.beginPath(),this.style.borderWidth>0&&(t.lineWidth=this.style.borderWidth),this.style.dashed?t.setLineDash([5]):t.setLineDash([0]),t.strokeStyle=this.style.borderColor,t.fillStyle=this.style.backgroundColor;var e=this.path[0].getTruePosition(i),r=g()(e,2),s=r[0],a=r[1];t.moveTo(s,a);for(var o=1;o<this.path.length;o++){var u=this.path[o].getTruePosition(i),d=g()(u,2),c=d[0],P=d[1];t.lineTo(c,P)}t.lineTo(s,a),t.fill(),t.stroke(),t.closePath();for(var w=0;w<this.path.length;w++)this.drawCtr(this.path[w],t,i);for(var T=0;T<this.centers.length;T++)this.drawCtrCenter(this.centers[T],t,i)}},{key:"drawCtr",value:function(t,i,e){i.beginPath(),i.lineWidth=1,i.setLineDash([0]),i.strokeStyle="green",i.fillStyle="#1890ff";var r=t.getTruePosition(e),s=g()(r,2),a=s[0],o=s[1];i.arc(a,o,this.ctrlRadius,0,Math.PI*2),i.fill(),i.closePath(),i.stroke()}},{key:"drawCtrCenter",value:function(t,i,e){i.beginPath(),i.lineWidth=1,i.setLineDash([0]),i.strokeStyle="#e4393c";var r=t.getTruePosition(e),s=g()(r,2),a=s[0],o=s[1];i.arc(a,o,this.ctrlRadius,0,Math.PI*2),i.closePath(),i.stroke()}},{key:"isInCtrPoint",value:function(t,i,e){return t>e.x-this.ctrlRadius&&t<e.x+this.ctrlRadius&&i>e.y-this.ctrlRadius&&i<e.y+this.ctrlRadius}},{key:"centers",get:function(){for(var t=[],i=0;i<this.path.length;i++)if(this.path[i+1]){var e=this.path[i].toArray(),r=g()(e,2),s=r[0],a=r[1],o=this.path[i+1].toArray(),u=g()(o,2),d=u[0],c=u[1],P=new p((d+s)/2,(c+a)/2);t.push(P)}var w=this.path[0].toArray(),T=g()(w,2),M=T[0],S=T[1],I=this.path[this.path.length-1].toArray(),O=g()(I,2),j=O[0],N=O[1],G=new p((j+M)/2,(N+S)/2);return t.push(G),t}},{key:"isInPath",value:function(t){for(var i=0;i<this.path.length;i++)if(this.isInCtrPoint(t.x,t.y,this.path[i]))return this.targets="path",this.actived=i,!0;for(var e=0;e<this.centers.length;e++)if(this.isInCtrPoint(t.x,t.y,this.centers[e]))return this.targets="center",this.actived=e,!0;for(var r=!1,s=-1,a=this.path.length,o=a-1;++s<a;o=s)(this.path[s].y<=t.y&&t.y<this.path[o].y||this.path[o].y<=t.y&&t.y<this.path[s].y)&&t.x<(this.path[o].x-this.path[s].x)*(t.y-this.path[s].y)/(this.path[o].y-this.path[s].y)+this.path[s].x&&(r=!r);return r}},{key:"mousedown",value:function(t){if(this.sx=t.x,this.sy=t.y,this.targets=="path"){var i=this.path[this.actived];this.px=i.x,this.py=i.y}else if(this.targets=="center"){var e=this.centers[this.actived];this.px=e.x,this.py=e.y}}},{key:"mousemove",value:function(t){var i=t.x-this.sx,e=t.y-this.sy,r=new p(this.px+i,this.py+e);this.targets=="path"?this.path.splice(this.actived,1,r):(this.path.splice(this.actived+1,0,r),this.targets="path",this.actived+=1)}},{key:"onSave",value:function(){return{path:this.path,style:this.style}}},{key:"changeStyle",value:function(t){this.style=t}}]),h}(),Tt={backgroundColor:"rgba(3,3,3,.2)",borderColor:"transparent",borderWidth:1,dashed:!1},At=function(h){H()(t,h);var n=U()(t);function t(i){var e,r=i.path,s=r===void 0?[]:r,a=i.style;return f()(this,t),e=n.call(this,"geometry"),l()(k()(e),"style",void 0),l()(k()(e),"styleBack",void 0),l()(k()(e),"path",void 0),l()(k()(e),"pathBack",void 0),l()(k()(e),"editLayer",void 0),e.style=e.styleBack=D(Tt,a),e.path=e.pathBack=s,e}return m()(t,[{key:"getArea",value:function(){for(var e=0,r=this.path.length,s=r-1,a,o,u=0;u<r;s=u++)a=this.path[u],o=this.path[s],e+=a.x*o.y,e-=a.y*o.x;return e/=2,e}},{key:"getCenter",value:function(){var e=this.path.length;if(!(e<=1)){for(var r=0,s=0,a,o=e-1,u,d,c=0;c<e;o=c++)u=this.path[c],d=this.path[o],a=u.x*d.y-d.x*u.y,r+=(u.x+d.x)*a,s+=(u.y+d.y)*a;return a=this.getArea()*6,new p(r/a,s/a)}}},{key:"isInPath",value:function(e){if(this.isEdit){var r,s;return(r=(s=this.editLayer)===null||s===void 0?void 0:s.isInPath(e))!==null&&r!==void 0?r:!1}else{for(var a=!1,o=-1,u=this.path.length,d=u-1;++o<u;d=o)(this.path[o].y<=e.y&&e.y<this.path[d].y||this.path[d].y<=e.y&&e.y<this.path[o].y)&&e.x<(this.path[d].x-this.path[o].x)*(e.y-this.path[o].y)/(this.path[d].y-this.path[o].y)+this.path[o].x&&(a=!a);return a}}},{key:"render",value:function(e,r){if(this.isEdit){var s;(s=this.editLayer)===null||s===void 0||s.paint(e,r)}else{var a=this.path[0].getTruePosition(r),o=g()(a,2),u=o[0],d=o[1];e.beginPath(),this.style.borderWidth>0&&(e.lineWidth=this.style.borderWidth),this.style.dashed?e.setLineDash([5]):e.setLineDash([0]),e.strokeStyle=this.style.borderColor,e.fillStyle=this.style.backgroundColor,e.moveTo(u,d);for(var c=1;c<this.path.length;c++){var P=this.path[c].getTruePosition(r),w=g()(P,2),T=w[0],M=w[1];e.lineTo(T,M)}e.lineTo(u,d),e.closePath(),e.fill(),e.stroke()}}},{key:"startEdit",value:function(){this.isEdit=!0,this.editLayer=new Lt(this.path,this.style)}},{key:"saveEdit",value:function(){if(this.editLayer){var e=this.editLayer.onSave(),r=e.path,s=e.style;this.path=r.map(function(a){return p.clone(a)}),this.pathBack=r.map(function(a){return p.clone(a)}),this.style=this.styleBack=s,this.editLayer=void 0,this.isEdit=!1}}},{key:"cancelEdit",value:function(){this.editLayer=void 0,this.isEdit=!1,this.reset()}},{key:"reset",value:function(){this.path=this.pathBack.map(function(e){return p.clone(e)}),this.style=this.styleBack}},{key:"onmousedown",value:function(e){if(this.isEdit){var r;(r=this.editLayer)===null||r===void 0||r.mousedown.call(this.editLayer,e)}}},{key:"onmousemove",value:function(e){if(this.isEdit){var r;(r=this.editLayer)===null||r===void 0||r.mousemove.call(this.editLayer,e)}}}]),t}(X),Mt={node:{color:"#1890ff",borderWidth:2,borderColor:"green"},nodeLine:{width:2,color:"green"},backgroundColor:"rgba(255,255,0, .5)"},St=function(){function h(n){f()(this,h),l()(this,"style",void 0),l()(this,"paths",[]),l()(this,"actived",void 0),l()(this,"isClose",!1),this.style=D(Mt,n)}return m()(h,[{key:"reset",value:function(){this.paths=[],this.actived=void 0,this.isClose=!1}},{key:"updatePath",value:function(t){this.paths.push(t)}},{key:"setActived",value:function(t){this.actived=t,this.isClose=this.paths.length>1}},{key:"first",get:function(){return this.paths[0]}},{key:"last",get:function(){if(this.paths.length)return this.paths[this.paths.length-1]}},{key:"render",value:function(t,i){this.first&&(t.save(),this.paths.length==1?(this.drawActive(t,i),this.drawStart(t,i)):(this.drawLine(t,i),this.drawNode(t,i)),t.restore())}},{key:"drawActive",value:function(t,i){if(!(!this.last||!this.actived)){t.beginPath(),t.lineWidth=this.style.nodeLine.width,t.strokeStyle=this.style.nodeLine.color,t.setLineDash([5]);var e=this.last.getTruePosition(i),r=g()(e,2),s=r[0],a=r[1];t.moveTo(s,a);var o=this.actived.getTruePosition(i),u=g()(o,2),d=u[0],c=u[1];t.lineTo(d,c),t.stroke(),t.closePath()}}},{key:"drawStart",value:function(t,i){if(this.first){t.strokeStyle=this.style.node.borderColor,t.lineWidth=this.style.node.borderWidth,t.setLineDash([0]),t.beginPath(),t.fillStyle=this.style.node.color;var e=this.first.getTruePosition(i),r=g()(e,2),s=r[0],a=r[1];t.arc(s,a,4,0,Math.PI*2),t.stroke(),t.fill(),t.closePath()}}},{key:"drawLine",value:function(t,i){if(!(!this.first||!this.actived)){t.beginPath(),t.strokeStyle=this.style.nodeLine.color,t.lineWidth=this.style.nodeLine.width,t.setLineDash([5]);var e=this.first.getTruePosition(i),r=g()(e,2),s=r[0],a=r[1];t.moveTo(s,a);for(var o=1;o<this.paths.length;o++){var u=this.paths[o].getTruePosition(i),d=g()(u,2),c=d[0],P=d[1];t.lineTo(c,P)}var w=this.actived.getTruePosition(i),T=g()(w,2),M=T[0],S=T[1];t.lineTo(M,S),t.lineTo(s,a),t.fillStyle=this.style.backgroundColor,t.fill(),t.stroke()}}},{key:"drawNode",value:function(t,i){t.setLineDash([0]),t.lineWidth=this.style.node.borderWidth,t.strokeStyle=this.style.node.borderColor;for(var e=0;e<this.paths.length;e++){t.beginPath(),t.fillStyle=this.style.node.color;var r=this.paths[e].getTruePosition(i),s=g()(r,2),a=s[0],o=s[1];t.arc(a,o,4,0,Math.PI*2),t.stroke(),t.fill(),t.closePath()}}},{key:"genPath",value:function(){return this.paths.map(function(t){return p.clone(t)})}},{key:"clearPath",value:function(){this.paths.pop()}}]),h}(),xt=function(){function h(n,t,i){f()(this,h),l()(this,"start",void 0),l()(this,"end",void 0),l()(this,"active",void 0),l()(this,"sx",0),l()(this,"sy",0),l()(this,"px",0),l()(this,"py",0),l()(this,"ctrlRadius",4),l()(this,"style",void 0),this.start=p.clone(n),this.end=p.clone(t),this.style=i}return m()(h,[{key:"paint",value:function(t,i){t.save(),t.beginPath(),this.style.width>0&&(t.lineWidth=this.style.width),this.style.dashed?t.setLineDash([5]):t.setLineDash([0]),t.strokeStyle=this.style.color;var e=this.start.getTruePosition(i),r=g()(e,2),s=r[0],a=r[1],o=this.end.getTruePosition(i),u=g()(o,2),d=u[0],c=u[1];t.moveTo(s,a),t.lineTo(d,c),t.closePath(),t.stroke(),this.paintCtr(this.start,t,i),this.paintCtr(this.end,t,i),t.restore()}},{key:"paintCtr",value:function(t,i,e){i.beginPath(),i.lineWidth=1,i.setLineDash([0]),i.strokeStyle="green",i.fillStyle="#1890ff";var r=t.getTruePosition(e),s=g()(r,2),a=s[0],o=s[1];i.arc(a,o,this.ctrlRadius,0,Math.PI*2),i.fill(),i.closePath(),i.stroke()}},{key:"isInCtrPoint",value:function(t,i){return t.x>i.x-this.ctrlRadius&&t.x<i.x+this.ctrlRadius&&t.y>i.y-this.ctrlRadius&&t.y<i.y+this.ctrlRadius}},{key:"isInPath",value:function(t){if(this.isInCtrPoint(t,this.start))return this.active="start",!0;if(this.isInCtrPoint(t,this.end))return this.active="end",!0;this.active=void 0;var i=10,e=Math.atan2(this.end.y-this.start.y,this.end.x-this.start.x),r=p.getCenter(this.start,this.end),s=p.rotateByPoint(t,r,-e).toArray(),a=g()(s,2),o=a[0],u=a[1],d=p.rotateByPoint(this.start,r,-e).toArray(),c=g()(d,2),P=c[0],w=c[1],T=p.rotateByPoint(this.end,r,-e).toArray(),M=g()(T,2),S=M[0],I=M[1];return Math.min(P,S)<=o&&Math.max(P,S)>=o&&Math.min(w+i,I-i)<=u&&Math.max(w+i,I-i)>=u}},{key:"mousedown",value:function(t){this.sx=t.x,this.sy=t.y,this.active=="start"?(this.px=this.start.x,this.py=this.start.y):this.active=="end"&&(this.px=this.end.x,this.py=this.end.y)}},{key:"mousemove",value:function(t){var i=t.x-this.sx,e=t.y-this.sy;this.active=="start"?this.start=new p(this.px+i,this.py+e):this.active=="end"&&(this.end=new p(this.px+i,this.py+e))}},{key:"onSave",value:function(){return{start:this.start,end:this.end,style:this.style}}},{key:"changeStyle",value:function(t){this.style=t}}]),h}(),q={width:1,color:"#000",dashed:!1},It=function(h){H()(t,h);var n=U()(t);function t(i){var e,r=i.style,s=i.start,a=i.end;return f()(this,t),e=n.call(this,"line"),l()(k()(e),"style",void 0),l()(k()(e),"styleBackup",void 0),l()(k()(e),"editLayer",void 0),l()(k()(e),"start",void 0),l()(k()(e),"_startBackup",void 0),l()(k()(e),"end",void 0),l()(k()(e),"_endBackup",void 0),e.start=p.fromArray(s.toArray()),e.end=p.fromArray(a.toArray()),e._endBackup=p.fromArray(a.toArray()),e._startBackup=p.fromArray(s.toArray()),e.style=D(q,r),e.styleBackup=D(q,r),e}return m()(t,[{key:"long",get:function(){var e=Math.sqrt(Math.pow(this.end.y-this.start.y,2)+Math.pow(this.end.x-this.start.x,2));return e}},{key:"isInPath",value:function(e){if(this.isEdit){var r,s;return(r=(s=this.editLayer)===null||s===void 0?void 0:s.isInPath(e))!==null&&r!==void 0?r:!1}else{var a=10,o=Math.atan2(this.end.y-this.start.y,this.end.x-this.start.x),u=p.getCenter(this.start,this.end),d=p.rotateByPoint(e,u,-o).toArray(),c=g()(d,2),P=c[0],w=c[1],T=p.rotateByPoint(this.start,u,-o).toArray(),M=g()(T,2),S=M[0],I=M[1],O=p.rotateByPoint(this.end,u,-o).toArray(),j=g()(O,2),N=j[0],G=j[1];return Math.min(S,N)<=P&&Math.max(S,N)>=P&&Math.min(I+a,G-a)<=w&&Math.max(I+a,G-a)>=w}}},{key:"getPath",value:function(){var e=this.start.toArray(),r=g()(e,2),s=r[0],a=r[1],o=this.end.toArray(),u=g()(o,2),d=u[0],c=u[1];return{type:this.type,path:[[Number(s.toFixed(2)),Number(a.toFixed(2))],[Number(d.toFixed(2)),Number(c.toFixed(2))]],style:this.style}}},{key:"changeStyle",value:function(e){var r,s=V()(V()({},this.style),e);this.style=s,(r=this.editLayer)===null||r===void 0||r.changeStyle(s)}},{key:"reset",value:function(){this.start=p.clone(this._startBackup),this.end=p.clone(this._endBackup),this.style=this.styleBackup}},{key:"render",value:function(e,r){if(this.isEdit){var s;(s=this.editLayer)===null||s===void 0||s.paint(e,r)}else{e.beginPath(),this.style.width>0&&(e.lineWidth=this.style.width),this.style.dashed?e.setLineDash([5]):e.setLineDash([0]),e.strokeStyle=this.style.color;var a=this.start.getTruePosition(r),o=g()(a,2),u=o[0],d=o[1],c=this.end.getTruePosition(r),P=g()(c,2),w=P[0],T=P[1];e.moveTo(u,d),e.lineTo(w,T),e.closePath(),e.stroke()}}},{key:"startEdit",value:function(){this.isEdit=!0,this.editLayer=new xt(this.start,this.end,this.style)}},{key:"saveEdit",value:function(){if(this.editLayer){var e=this.editLayer.onSave(),r=e.start,s=e.end,a=e.style;this.end=p.clone(s),this.start=p.clone(r),this._startBackup=p.clone(r),this._endBackup=p.clone(s),this.style=a,this.editLayer=void 0,this.isEdit=!1}}},{key:"cancelEdit",value:function(){this.editLayer=void 0,this.isEdit=!1,this.reset()}},{key:"onmousedown",value:function(e){if(this.isEdit){var r;(r=this.editLayer)===null||r===void 0||r.mousedown.call(this.editLayer,e)}}},{key:"onmousemove",value:function(e){if(this.isEdit){var r;(r=this.editLayer)===null||r===void 0||r.mousemove.call(this.editLayer,e)}}}]),t}(X),Dt=It,Bt={borderWidth:1,borderColor:"#000",dashed:!0},Rt=function(){function h(n){f()(this,h),l()(this,"style",void 0),l()(this,"start",void 0),l()(this,"end",void 0),this.style=D(Bt,n)}return m()(h,[{key:"setActived",value:function(t,i){var e=new p(t,i);this.start&&(this.end=e)}},{key:"setStart",value:function(t,i){this.start=new p(t,i)}},{key:"reset",value:function(){this.start=void 0,this.end=void 0}},{key:"render",value:function(t,i){if(this.start&&this.end){t.save(),t.beginPath(),t.lineWidth=this.style.borderWidth,this.style.dashed?t.setLineDash([5]):t.setLineDash([0]),t.strokeStyle=this.style.borderColor;var e=this.start.getTruePosition(i),r=g()(e,2),s=r[0],a=r[1],o=this.end.getTruePosition(i),u=g()(o,2),d=u[0],c=u[1];t.moveTo(s,a),t.lineTo(d,c),t.stroke(),t.closePath(),t.restore()}}}]),h}(),Wt=Rt,_=function(){function h(n){f()(this,h),l()(this,"center",void 0),l()(this,"image",void 0),l()(this,"style",void 0),l()(this,"sx",0),l()(this,"sy",0),l()(this,"px",0),l()(this,"py",0);var t=n.style,i=n.image,e=n.center;this.image=i,this.style=t,this.center=e}return m()(h,[{key:"draw",value:function(t){if(t.save(),this.image){var i=this.center.x-10,e=this.center.y-38;t.drawImage(this.image,i,e,40,40)}else t.beginPath(),t.fillStyle=this.style.color,t.arc(this.center.x,this.center.y,this.style.size,0,2*Math.PI),t.fill(),t.closePath();t.restore()}},{key:"isInPath",value:function(t){var i=this.center.toArray(),e=g()(i,2),r=e[0],s=e[1],a=t.toArray(),o=g()(a,2),u=o[0],d=o[1];if(this.image){var c=u>=r-10&&u<=r+10,P=d>=s-40&&d<=s;return c&&P}else{var w=Math.sqrt(Math.pow(d-this.center.y,2)+Math.pow(u-this.center.x,2));return w<this.style.size*2}}},{key:"changeStyle",value:function(t){this.style=t}},{key:"mousedown",value:function(t){this.sx=t.x,this.sy=t.y,this.px=this.center.x,this.py=this.center.y}},{key:"mousemove",value:function(t){var i=t.x-this.sx,e=t.y-this.sy;this.center=new p(this.px+i,this.py+e)}},{key:"save",value:function(){return{center:this.center,style:this.style}}}]),h}(),tt={color:"red",size:4,width:40,height:40,offset:[0,0]},Y=function(h){return h[h.Loading=0]="Loading",h[h.Loaded=1]="Loaded",h[h.LoadError=2]="LoadError",h}(Y||{}),Ot=function(h){H()(t,h);var n=U()(t);function t(i,e){var r;if(f()(this,t),r=n.call(this,"mark"),l()(k()(r),"style",void 0),l()(k()(r),"_style",void 0),l()(k()(r),"image",void 0),l()(k()(r),"status",Y.Loading),l()(k()(r),"editLayer",void 0),l()(k()(r),"center",void 0),r.center=i,r.style=D(tt,e),r._style=D(tt,e),r.style.src!==void 0&&r.style.src!==""){var s=new Image;s.src=r.style.src,s.crossOrigin="Anonymous",s.onload=function(){r.status=Y.Loaded},s.onerror=function(){r.status=Y.LoadError},r.image=s}return r}return m()(t,[{key:"onmousedown",value:function(e){this.editLayer&&this.editLayer.mousedown.call(this.editLayer,e)}},{key:"onmousemove",value:function(e){this.editLayer&&this.editLayer.mousemove.call(this.editLayer,e)}},{key:"isInPath",value:function(e){var r=e.x,s=e.y,a=this.center.toArray(),o=g()(a,2),u=o[0],d=o[1];if(this.isEdit){var c,P;return(c=(P=this.editLayer)===null||P===void 0?void 0:P.isInPath(e))!==null&&c!==void 0?c:!1}else if(this.image){var w=r>=u-this.style.width/2-this.style.offset[0]&&r<=u+this.style.width/2+this.style.offset[0],T=s>=d-this.style.height-this.style.offset[1]&&s<=d+this.style.offset[1];return w&&T}else{var M=Math.sqrt(Math.pow(s-this.center.y,2)+Math.pow(r-this.center.x,2));return M<this.style.size}}},{key:"getPath",value:function(){var e=this.center.toArray(),r=g()(e,2),s=r[0],a=r[1];return{type:this.type,path:[[Number(s.toFixed(2)),Number(a.toFixed(2))]],style:this.style}}},{key:"onEdit",value:function(){this.isEdit=!0,this.editLayer=new _({center:this.center,image:this.image,style:this.style})}},{key:"onSave",value:function(){if(this.editLayer){var e=this.editLayer.save(),r=e.center,s=e.style;this.style=s,this.center=r,this.isEdit=!1}}},{key:"changeStyle",value:function(e){var r;this.style=D(this.style,e),(r=this.editLayer)===null||r===void 0||r.changeStyle(this.style)}},{key:"reset",value:function(){this.style=Q(this._style)}},{key:"render",value:function(e,r){if(this.isEdit){var s;(s=this.editLayer)===null||s===void 0||s.draw(e)}else if(this.image)if(this.status===Y.Loading)e.textAlign="center",e.fillText("loading...",this.center.x,this.center.y);else if(this.status===Y.LoadError)e.textAlign="center",e.fillText("\u8D44\u6E90\u52A0\u8F7D\u5931\u8D25!",this.center.x,this.center.y);else{var a=this.center.x-this.style.width/2-this.style.offset[0],o=this.center.y-this.style.height-this.style.offset[1];e.drawImage(this.image,a,o,this.style.width,this.style.height)}else{e.beginPath(),e.fillStyle=this.style.color;var u=this.center.getTruePosition(r),d=g()(u,2),c=d[0],P=d[1];e.arc(c,P,this.style.size,0,2*Math.PI),e.fill(),e.closePath()}}},{key:"startEdit",value:function(){this.isEdit=!0,this.editLayer=new _({center:this.center,style:this.style,image:this.image})}},{key:"saveEdit",value:function(){if(this.editLayer){var e=this.editLayer.save(),r=e.center,s=e.style;this.center=p.clone(r),this.style=s,this.editLayer=void 0,this.isEdit=!1}}},{key:"cancelEdit",value:function(){this.editLayer=void 0,this.isEdit=!1,this.reset()}}]),t}(X),Ft=function(){function h(n,t,i){f()(this,h),l()(this,"start",void 0),l()(this,"end",void 0),l()(this,"active",void 0),l()(this,"style",void 0),l()(this,"sx",0),l()(this,"sy",0),l()(this,"px",0),l()(this,"py",0),l()(this,"ctrlRadius",4),this.start=p.clone(n),this.end=p.clone(t),this.style=i}return m()(h,[{key:"render",value:function(t,i){t.beginPath(),this.style.borderWidth>0&&(t.lineWidth=this.style.borderWidth),this.style.dashed?t.setLineDash([5]):t.setLineDash([0]),t.strokeStyle=this.style.borderColor,t.fillStyle=this.style.backgroundColor;var e=this.start.getTruePosition(i),r=g()(e,2),s=r[0],a=r[1],o=this.end.getTruePosition(i),u=g()(o,2),d=u[0],c=u[1];t.moveTo(s,a),t.lineTo(d,a),t.lineTo(d,c),t.lineTo(s,c),t.lineTo(s,a),t.closePath(),t.fill(),t.stroke(),this.drawCtr(this.start,t,i),this.drawCtr(this.end,t,i)}},{key:"drawCtr",value:function(t,i,e){i.beginPath(),i.lineWidth=1,i.setLineDash([0]),i.strokeStyle="green",i.fillStyle="#1890ff";var r=t.getTruePosition(e),s=g()(r,2),a=s[0],o=s[1];i.arc(a,o,this.ctrlRadius,0,Math.PI*2),i.fill(),i.closePath(),i.stroke()}},{key:"isInCtrPoint",value:function(t,i){var e=t.x,r=t.y;return e>i.x-this.ctrlRadius&&e<i.x+this.ctrlRadius&&r>i.y-this.ctrlRadius&&r<i.y+this.ctrlRadius}},{key:"isInPath",value:function(t){if(this.isInCtrPoint(t,this.start))return this.active="start",!0;if(this.isInCtrPoint(t,this.end))return this.active="end",!0;this.active=void 0;var i=t.x>=this.start.x&&t.x<=this.end.x,e=t.y>=this.start.y&&t.y<=this.end.y;return i&&e}},{key:"mousedown",value:function(t){this.sx=t.x,this.sy=t.y,this.active=="start"?(this.px=this.start.x,this.py=this.start.y):this.active=="end"&&(this.px=this.end.x,this.py=this.end.y)}},{key:"mousemove",value:function(t){var i=t.x-this.sx,e=t.y-this.sy;this.active=="start"?this.start=new p(this.px+i,this.py+e):this.active=="end"&&(this.end=new p(this.px+i,this.py+e))}},{key:"onSave",value:function(){return{start:this.start,end:this.end,style:this.style}}},{key:"changeStyle",value:function(t){this.style=t}}]),h}(),jt={backgroundColor:"rgba(3,3,3,.2)",borderColor:"transparent",borderWidth:1,dashed:!1},Nt=function(h){H()(t,h);var n=U()(t);function t(i){var e,r=i.start,s=i.end,a=i.style;return f()(this,t),e=n.call(this,"rect"),l()(k()(e),"style",void 0),l()(k()(e),"styleBackup",void 0),l()(k()(e),"start",void 0),l()(k()(e),"_startBackup",void 0),l()(k()(e),"end",void 0),l()(k()(e),"_endBackup",void 0),l()(k()(e),"editLayer",void 0),e.start=e._startBackup=p.clone(r),e.end=e._endBackup=p.clone(s),e.style=e.styleBackup=D(jt,a),e}return m()(t,[{key:"getCenter",value:function(){return p.getCenter(this.start,this.end)}},{key:"render",value:function(e,r){if(this.isEdit){var s;(s=this.editLayer)===null||s===void 0||s.render(e,r)}else{e.beginPath(),this.style.borderWidth>0&&(e.lineWidth=this.style.borderWidth),this.style.dashed?e.setLineDash([5]):e.setLineDash([0]),e.strokeStyle=this.style.borderColor,e.fillStyle=this.style.backgroundColor;var a=this.start.getTruePosition(r),o=g()(a,2),u=o[0],d=o[1],c=this.end.getTruePosition(r),P=g()(c,2),w=P[0],T=P[1];e.moveTo(u,d),e.lineTo(w,d),e.lineTo(w,T),e.lineTo(u,T),e.lineTo(u,d),e.closePath(),e.fill(),e.stroke()}}},{key:"isInPath",value:function(e){if(this.isEdit){var r,s;return(r=(s=this.editLayer)===null||s===void 0?void 0:s.isInPath(e))!==null&&r!==void 0?r:!1}else{var a=e.x>=this.start.x&&e.x<=this.end.x,o=e.y>=this.start.y&&e.y<=this.end.y;return a&&o}}},{key:"reset",value:function(){this.start=this._startBackup,this.end=this._endBackup,this.style=this.styleBackup}},{key:"startEdit",value:function(){this.isEdit=!0,this.editLayer=new Ft(this.start,this.end,this.style)}},{key:"saveEdit",value:function(){if(this.editLayer){var e=this.editLayer.onSave(),r=e.start,s=e.end,a=e.style;this.end=p.clone(s),this.start=p.clone(r),this._startBackup=p.clone(r),this._endBackup=p.clone(s),this.style=a,this.editLayer=void 0,this.isEdit=!1}}},{key:"cancelEdit",value:function(){this.editLayer=void 0,this.isEdit=!1,this.reset()}},{key:"onmousedown",value:function(e){if(this.isEdit){var r;(r=this.editLayer)===null||r===void 0||r.mousedown.call(this.editLayer,e)}}},{key:"onmousemove",value:function(e){if(this.isEdit){var r;(r=this.editLayer)===null||r===void 0||r.mousemove.call(this.editLayer,e)}}}]),t}(X),zt={borderWidth:1,borderColor:"#000",backgroundColor:"#fff",dashed:!1},Ht=function(){function h(n){f()(this,h),l()(this,"style",void 0),l()(this,"actived",void 0),l()(this,"start",void 0),this.style=D(zt,n)}return m()(h,[{key:"setActived",value:function(t){this.start&&(this.actived=p.clone(t))}},{key:"setStart",value:function(t){this.start=p.clone(t)}},{key:"width",get:function(){return!this.start||!this.actived?0:Math.abs(this.actived.x-this.start.x)}},{key:"height",get:function(){return!this.start||!this.actived?0:Math.abs(this.actived.y-this.start.y)}},{key:"reset",value:function(){this.start=void 0,this.actived=void 0}},{key:"render",value:function(t,i){if(this.start&&this.actived){t.save(),t.beginPath(),t.lineWidth=this.style.borderWidth,this.style.dashed?t.setLineDash([5]):t.setLineDash([0]),t.strokeStyle=this.style.borderColor,t.fillStyle=this.style.backgroundColor;var e=this.start.getTruePosition(i),r=g()(e,2),s=r[0],a=r[1],o=this.actived.getTruePosition(i),u=g()(o,2),d=u[0],c=u[1];t.moveTo(s,a),t.lineTo(d,a),t.lineTo(d,c),t.lineTo(s,c),t.lineTo(s,a),t.stroke(),t.fill(),t.closePath(),t.restore()}}}]),h}(),Ut=function(h){H()(t,h);var n=U()(t);function t(i){var e;return f()(this,t),e=n.call(this,i),l()(k()(e),"menu",void 0),l()(k()(e),"activedLayerIndex",-1),e.menu=new kt,i==null||i.appendChild(e.menu.el),e}return m()(t,[{key:"onContextMenu",value:function(e){R()(W()(t.prototype),"onContextMenu",this).call(this,e);var r=this.getPosition(e),s=this.getLayerByPosition(r),a=this.layers.length-1,o=this;s?this.menu.open(e.offsetX,e.offsetY,s.isEdit?{onSave:function(){s.saveEdit(),o.layers=$(o.layers,a,o.activedLayerIndex)},onCancel:function(){s.cancelEdit(),o.layers=$(o.layers,a,o.activedLayerIndex)}}:{onEdit:function(){o.activedLayerIndex=o.layers.findIndex(function(d){return d.uuid===s.uuid}),o.layers=$(o.layers,o.activedLayerIndex,a),s.startEdit.call(s)},onDelete:function(){o.deleteLayer(s),o.activedLayerIndex=-1}}):this.menu.close()}},{key:"bindDragEvent",value:function(e,r){R()(W()(t.prototype),"bindDragEvent",this).call(this,e,r),this.menu.isOpen&&this.menu.close()}},{key:"line",value:function(e){var r=this;this.removeEvents(),this.canvas.style.cursor="crosshair";var s=new Wt(e==null?void 0:e.activeStyle);this.activedLayer=s,this.canvas.onmousedown=function(a){if(a.button===0){var o=r.getPosition(a),u=o.x,d=o.y;s.setStart(u,d),r.canvas.onmousemove=function(c){var P=r.getPosition(c);s.setActived(P.x,P.y)}}},this.canvas.onmouseup=function(a){r.canvas.onmousemove=null;var o=r.getPosition(a);if(s.start){var u=Math.sqrt(Math.pow(o.y-s.start.y,2)+Math.pow(o.x-s.start.x,2));if(u>5){var d,c=new Dt({start:s.start,end:o,style:e==null?void 0:e.lineStyle});r.addlayer(c),e==null||(d=e.onSuccess)===null||d===void 0||d.call(e,c)}else s.reset()}r.afterPaint()},this.canvas.onmouseleave=function(){r.canvas.onmousemove=null,r.afterPaint()}}},{key:"mark",value:function(e){var r=this;this.removeEvents(),this.canvas.style.cursor="crosshair",this.canvas.onmousedown=function(s){var a;if(s.button===0){var o=r.getPosition(s),u=new Ot(o,{src:e==null?void 0:e.src,color:e==null?void 0:e.color,size:e==null?void 0:e.size});r.addlayer(u),r.afterPaint(),e==null||(a=e.onSuccess)===null||a===void 0||a.call(e,u)}}}},{key:"cricular",value:function(e){var r=this;this.removeEvents(),this.canvas.style.cursor="crosshair";var s=new Ct(e==null?void 0:e.activeStyle);this.activedLayer=s;var a=function(u){var d=r.getPosition(u);s.setActived(d)};this.canvas.onmousedown=function(o){if(o.button===0){var u=r.getPosition(o);s.setCenter(u),r.canvas.addEventListener("mousemove",a)}},this.canvas.onmouseup=function(){if(r.canvas.removeEventListener("mousemove",a),s.center&&s.radius>0){var o,u=new wt({center:s.center,radius:s.radius,style:e==null?void 0:e.cricularStyle});r.addlayer(u),r.afterPaint(),e==null||(o=e.onSuccess)===null||o===void 0||o.call(e,u)}},this.canvas.onmouseleave=function(){r.canvas.removeEventListener("mousemove",a),r.afterPaint()}}},{key:"geometry",value:function(e){var r=this;this.removeEvents(),this.canvas.style.cursor="crosshair";var s,a=new St(e==null?void 0:e.activeStyle);this.activedLayer=a,this.canvas.onmousedown=function(o){s&&clearTimeout(s),s=setTimeout(function(){if(o.button===0){var u=r.getPosition(o);a.updatePath(u),r.canvas.onmousemove=function(d){var c=r.getPosition(d);a.setActived(c)}}},100)},this.canvas.oncontextmenu=function(o){o.preventDefault(),clearTimeout(s),a&&(a.first?a.clearPath():r.afterPaint())},this.canvas.ondblclick=function(o){if(o.stopPropagation(),o.preventDefault(),clearTimeout(s),a.isClose){var u,d=a.genPath(),c=new At({path:d,style:e==null?void 0:e.geoStyle});r.addlayer(c),e==null||(u=e.onSuccess)===null||u===void 0||u.call(e,c),r.afterPaint()}}}},{key:"rect",value:function(e){var r=this;this.removeEvents(),this.canvas.style.cursor="crosshair";var s=new Ht(e==null?void 0:e.activeStyle);this.activedLayer=s;var a=function(u){s.setActived(r.getPosition(u))};this.canvas.onmousedown=function(o){o.button===0&&(r.canvas.addEventListener("mousemove",a),s.setStart(r.getPosition(o)))},this.canvas.onmouseup=function(o){r.canvas.removeEventListener("mousemove",a);var u=r.getPosition(o);if(s.start&&s.width>20&&s.height>20){var d,c=new Nt({start:s.start,end:u,style:e==null?void 0:e.rectStyle});r.addlayer(c),r.afterPaint(),e==null||(d=e.onSuccess)===null||d===void 0||d.call(e,c)}else s.reset()},this.canvas.onmouseleave=function(){r.afterPaint()}}}]),t}(mt),B=y(85893);function Yt(){var h=(0,L.useRef)(null),n=(0,L.useRef)();return(0,L.useEffect)(function(){return h.current&&(n.current=new Ut(h.current)),function(){var t;(t=n.current)===null||t===void 0||t.destroy(),n.current=void 0}},[]),(0,B.jsxs)("div",{children:[(0,B.jsx)("div",{className:"box",ref:h}),(0,B.jsx)("button",{type:"button",onClick:function(){var i;(i=n.current)===null||i===void 0||i.mark()},children:"\u7ED8\u5236\u70B9"}),(0,B.jsx)("button",{type:"button",onClick:function(){var i;(i=n.current)===null||i===void 0||i.line()},children:"\u7ED8\u5236\u7EBF\u6761"}),(0,B.jsx)("button",{type:"button",onClick:function(){var i;(i=n.current)===null||i===void 0||i.rect()},children:"\u7ED8\u5236\u77E9\u5F62"}),(0,B.jsx)("button",{type:"button",onClick:function(){var i;(i=n.current)===null||i===void 0||i.rect({activeStyle:{backgroundColor:"rgba(234,12,144,.7)"},rectStyle:{backgroundColor:"#e4393c"}})},children:"\u7ED8\u5236\u4E00\u4E2A\u7EA2\u8272\u7684\u77E9\u5F62"}),(0,B.jsx)("button",{type:"button",onClick:function(){var i;(i=n.current)===null||i===void 0||i.cricular()},children:"\u7ED8\u5236\u5706\u5F62"}),(0,B.jsx)("button",{type:"button",onClick:function(){var i;(i=n.current)===null||i===void 0||i.geometry()},children:"\u7ED8\u5236\u533A\u57DF"}),(0,B.jsx)("button",{type:"button",onClick:function(){var i;(i=n.current)===null||i===void 0||i.geometry({activeStyle:{backgroundColor:"red"},geoStyle:{backgroundColor:"rgba(234,123,15, 0.8)"},onSuccess:function(r){alert("\u7ED8\u5236\u6210\u529F"),r.onclick(function(){alert("\u70B9\u51FB\u4E86\u533A\u57DF")})}})},children:"\u7ED8\u5236\u533A\u57DF\u5E76\u8BBE\u7F6E\u533A\u57DF\u989C\u8272"}),(0,B.jsx)("button",{type:"button",onClick:function(){var i;(i=n.current)===null||i===void 0||i.reset()},children:"\u91CD\u7F6E\u539F\u70B9"})]})}var Gt=Yt},63405:function(v,E,y){var L=y(73897);function C(f){if(Array.isArray(f))return L(f)}v.exports=C,v.exports.__esModule=!0,v.exports.default=v.exports},66115:function(v){function E(y){if(y===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return y}v.exports=E,v.exports.__esModule=!0,v.exports.default=v.exports},74704:function(v,E,y){var L=y(86116);function C(f,b){var m=typeof Symbol!="undefined"&&f[Symbol.iterator]||f["@@iterator"];if(!m){if(Array.isArray(f)||(m=L(f))||b&&f&&typeof f.length=="number"){m&&(f=m);var A=0,k=function(){};return{s:k,n:function(){return A>=f.length?{done:!0}:{done:!1,value:f[A++]}},e:function(F){throw F},f:k}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var x=!0,R=!1,z;return{s:function(){m=m.call(f)},n:function(){var F=m.next();return x=F.done,F},e:function(F){R=!0,z=F},f:function(){try{!x&&m.return!=null&&m.return()}finally{if(R)throw z}}}}v.exports=C,v.exports.__esModule=!0,v.exports.default=v.exports},26389:function(v,E,y){var L=y(73808),C=y(69617),f=y(94993);function b(m){var A=C();return function(){var x=L(m),R;if(A){var z=L(this).constructor;R=Reflect.construct(x,arguments,z)}else R=x.apply(this,arguments);return f(this,R)}}v.exports=b,v.exports.__esModule=!0,v.exports.default=v.exports},41588:function(v,E,y){var L=y(1753);function C(){return typeof Reflect!="undefined"&&Reflect.get?(v.exports=C=Reflect.get.bind(),v.exports.__esModule=!0,v.exports.default=v.exports):(v.exports=C=function(b,m,A){var k=L(b,m);if(k){var x=Object.getOwnPropertyDescriptor(k,m);return x.get?x.get.call(arguments.length<3?b:A):x.value}},v.exports.__esModule=!0,v.exports.default=v.exports),C.apply(this,arguments)}v.exports=C,v.exports.__esModule=!0,v.exports.default=v.exports},73808:function(v){function E(y){return v.exports=E=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(C){return C.__proto__||Object.getPrototypeOf(C)},v.exports.__esModule=!0,v.exports.default=v.exports,E(y)}v.exports=E,v.exports.__esModule=!0,v.exports.default=v.exports},61655:function(v,E,y){var L=y(6015);function C(f,b){if(typeof b!="function"&&b!==null)throw new TypeError("Super expression must either be null or a function");f.prototype=Object.create(b&&b.prototype,{constructor:{value:f,writable:!0,configurable:!0}}),Object.defineProperty(f,"prototype",{writable:!1}),b&&L(f,b)}v.exports=C,v.exports.__esModule=!0,v.exports.default=v.exports},69617:function(v){function E(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(y){return!1}}v.exports=E,v.exports.__esModule=!0,v.exports.default=v.exports},79498:function(v){function E(y){if(typeof Symbol!="undefined"&&y[Symbol.iterator]!=null||y["@@iterator"]!=null)return Array.from(y)}v.exports=E,v.exports.__esModule=!0,v.exports.default=v.exports},42281:function(v){function E(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}v.exports=E,v.exports.__esModule=!0,v.exports.default=v.exports},70215:function(v,E,y){var L=y(7071);function C(f,b){if(f==null)return{};var m=L(f,b),A,k;if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(f);for(k=0;k<x.length;k++)A=x[k],!(b.indexOf(A)>=0)&&Object.prototype.propertyIsEnumerable.call(f,A)&&(m[A]=f[A])}return m}v.exports=C,v.exports.__esModule=!0,v.exports.default=v.exports},7071:function(v){function E(y,L){if(y==null)return{};var C={},f=Object.keys(y),b,m;for(m=0;m<f.length;m++)b=f[m],!(L.indexOf(b)>=0)&&(C[b]=y[b]);return C}v.exports=E,v.exports.__esModule=!0,v.exports.default=v.exports},94993:function(v,E,y){var L=y(18698).default,C=y(66115);function f(b,m){if(m&&(L(m)==="object"||typeof m=="function"))return m;if(m!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return C(b)}v.exports=f,v.exports.__esModule=!0,v.exports.default=v.exports},6015:function(v){function E(y,L){return v.exports=E=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(f,b){return f.__proto__=b,f},v.exports.__esModule=!0,v.exports.default=v.exports,E(y,L)}v.exports=E,v.exports.__esModule=!0,v.exports.default=v.exports},1753:function(v,E,y){var L=y(73808);function C(f,b){for(;!Object.prototype.hasOwnProperty.call(f,b)&&(f=L(f),f!==null););return f}v.exports=C,v.exports.__esModule=!0,v.exports.default=v.exports},861:function(v,E,y){var L=y(63405),C=y(79498),f=y(86116),b=y(42281);function m(A){return L(A)||C(A)||f(A)||b()}v.exports=m,v.exports.__esModule=!0,v.exports.default=v.exports}}]);
